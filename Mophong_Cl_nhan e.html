<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô phỏng chlorine nhận electron</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body {
            background-color: #f1f5f9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .electron {
            filter: drop-shadow(0 0 3px rgba(59, 130, 246, 0.8));
        }
        .shell {
            fill: none;
            stroke: #cbd5e1;
            stroke-width: 1.5;
            stroke-dasharray: 5;
        }
        .ion-bracket {
            stroke: #1e293b;
            stroke-width: 3;
            fill: none;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        #charge-sign {
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        .counter-badge {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8 max-w-5xl w-full border border-slate-200 overflow-hidden">
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-extrabold text-slate-800 mb-1">Mô phỏng nguyên tử chlorine nhận electron</h1>
            <p class="text-slate-500 font-medium">Mô phỏng quá trình hình thành ion chloride (Cl<sup>-</sup>)</p>
            <p class="text-slate-500 font-medium">Thiết kế: Nguyễn Mạnh Hưng</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
            
            <!-- Simulation Viewport -->
            <div class="relative flex flex-col items-center justify-center bg-slate-50 rounded-2xl p-2 border border-slate-100 min-h-[460px]">
                <div id="simulation-box" class="w-full h-full flex items-center justify-center">
                    <svg viewBox="0 0 400 400" class="w-full h-full max-w-[380px]">
                        <!-- Brackets -->
                        <path id="left-bracket" class="ion-bracket" d="M 40,40 L 20,40 L 20,360 L 40,360" />
                        <path id="right-bracket" class="ion-bracket" d="M 360,40 L 380,40 L 380,360 L 360,360" />
                        <text id="charge-sign" class="text-5xl font-bold" x="385" y="60" fill="#dc2626">-</text>

                        <!-- Orbitals -->
                        <circle class="shell" cx="200" cy="200" r="55" />
                        <circle class="shell" cx="200" cy="200" r="100" />
                        <circle class="shell" cx="200" cy="200" r="145" />

                        <!-- Nucleus -->
                        <circle cx="200" cy="200" r="32" fill="#fbbf24" class="shadow-inner" />
                        <text x="200" y="208" text-anchor="middle" fill="#92400e" font-weight="bold" font-size="22">+17</text>

                        <!-- Electrons -->
                        <g id="electrons-layer"></g>

                        <!-- Moving Electron for animation (Placeholder) -->
                        <circle id="incoming-electron" cx="420" cy="-20" r="7" fill="#3b82f6" opacity="0" />
                    </svg>
                </div>

                <!-- Live Label -->
                <div class="absolute bottom-6 bg-white/80 backdrop-blur px-6 py-2 rounded-full shadow-sm border border-slate-200">
                    <span id="label-name" class="text-3xl font-black text-slate-700">Cl</span>
                </div>
            </div>

            <!-- Panel -->
            <div class="flex flex-col h-full justify-between gap-6">
                <div class="space-y-4">
                    <div class="bg-indigo-50 border-l-4 border-indigo-500 p-5 rounded-r-xl">
                        <h2 class="font-bold text-indigo-900 text-lg mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h.01a1 1 0 100-2H10zm3 0a1 1 0 000 2h.01a1 1 0 100-2H13zM7 13a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h.01a1 1 0 100-2H10zm3 0a1 1 0 000 2h.01a1 1 0 100-2H13z" clip-rule="evenodd"></path></svg>
                            Thông số cấu tạo
                        </h2>
                        <div class="grid grid-cols-2 gap-4 text-sm md:text-base">
                            <div class="text-slate-600">Nguyên tử: <span class="font-bold text-slate-900">Chlorine</span></div>
                            <div class="text-slate-600">Số hiệu (Z): <span class="font-bold text-slate-900">17</span></div>
                            <div class="text-slate-600">Cấu hình: <span class="font-mono bg-white px-1 rounded border">[Ne]3s<sup>2</sup>3p<sup>5</sup></span></div>
                            <div class="text-slate-600">Số lớp e: <span class="font-bold text-slate-900">3</span></div>
                        </div>
                    </div>

                    <div id="status-card" class="bg-white border border-slate-200 p-5 rounded-xl shadow-sm space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-slate-700 font-semibold">Số electron lớp ngoài cùng:</span>
                            <span id="outer-count" class="counter-badge bg-slate-100 text-slate-800 px-3 py-1 rounded-full font-bold text-lg border border-slate-200">7</span>
                        </div>
                        <p id="description" class="text-slate-600 text-sm leading-relaxed border-t pt-3">
                            Nguyên tử Chlorine có 7 electron ở lớp ngoài cùng, còn thiếu 1 electron để đạt trạng thái bền vững (quy tắc bát tử).
                        </p>
                    </div>
                </div>

                <div class="space-y-3">
                    <button id="btn-animate" class="group w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2">
                        <span>Nhận 1 Electron</span>
                        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </button>
                    <button id="btn-reset" class="w-full bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-3 px-6 rounded-xl transition-colors">
                        Đặt lại (Reset)
                    </button>
                </div>

                <p class="text-[11px] text-slate-400 text-center italic">
                    "Xu hướng nhận thêm electron giúp Chlorine đạt cấu hình giống Argon (Ar)"
                </p>
            </div>
        </div>
    </div>

    <script>
        const btnAnimate = document.getElementById('btn-animate');
        const btnReset = document.getElementById('btn-reset');
        const electronsLayer = document.getElementById('electrons-layer');
        const incomingElectron = document.getElementById('incoming-electron');
        const description = document.getElementById('description');
        const labelName = document.getElementById('label-name');
        const outerCountLabel = document.getElementById('outer-count');
        const chargeSign = document.getElementById('charge-sign');
        const statusCard = document.getElementById('status-card');

        let isIon = false;
        let electronRefs = [];
        let animationFrame;

        // Configuration for Chlorine
        const config = {
            shells: [2, 8, 7],
            radii: [55, 100, 145],
            color: "#3b82f6" // Đồng nhất màu xanh cho tất cả electron
        };

        function createElectrons() {
            electronsLayer.innerHTML = '';
            electronRefs = [];
            
            config.shells.forEach((count, shellIdx) => {
                const r = config.radii[shellIdx];
                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * Math.PI * 2;
                    addElectronToSystem(r, angle, config.color, shellIdx);
                }
            });
        }

        function addElectronToSystem(radius, angle, color, shellIdx) {
            const el = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            el.setAttribute("r", 7);
            el.setAttribute("fill", color);
            el.setAttribute("class", "electron");
            electronsLayer.appendChild(el);
            
            electronRefs.push({
                element: el,
                angle: angle,
                radius: radius,
                speed: 0.008 + (shellIdx * 0.003)
            });
        }

        function animateLoop() {
            electronRefs.forEach(ref => {
                ref.angle += ref.speed;
                const x = 200 + ref.radius * Math.cos(ref.angle);
                const y = 200 + ref.radius * Math.sin(ref.angle);
                ref.element.setAttribute("cx", x);
                ref.element.setAttribute("cy", y);
            });
            animationFrame = requestAnimationFrame(animateLoop);
        }

        function startInteraction() {
            if (isIon) return;
            isIon = true;
            btnAnimate.disabled = true;
            btnAnimate.classList.add('opacity-40', 'cursor-not-allowed');

            // 1. Setup incoming electron start
            gsap.set(incomingElectron, { opacity: 1, cx: 400, cy: 0 });
            
            // 2. Animate to outer shell (shell index 2)
            const targetRadius = config.radii[2];
            const targetAngle = -Math.PI / 2; 
            const targetX = 200 + targetRadius * Math.cos(targetAngle);
            const targetY = 200 + targetRadius * Math.sin(targetAngle);

            gsap.to(incomingElectron, {
                duration: 1.2,
                cx: targetX,
                cy: targetY,
                ease: "power2.inOut",
                onComplete: () => {
                    // Ẩn electron placeholder hoàn toàn
                    gsap.set(incomingElectron, { opacity: 0 });
                    
                    // Thêm electron thực vào hệ thống (màu xanh đồng nhất)
                    addElectronToSystem(targetRadius, targetAngle, config.color, 2);

                    // Cập nhật trạng thái UI
                    gsap.to(".ion-bracket, #charge-sign", { opacity: 1, duration: 0.4 });
                    
                    labelName.innerHTML = "Cl<sup>-</sup>";
                    labelName.classList.add('text-blue-600');
                    
                    outerCountLabel.innerText = "8";
                    outerCountLabel.classList.replace('bg-slate-100', 'bg-blue-600');
                    outerCountLabel.classList.replace('text-slate-800', 'text-white');

                    statusCard.classList.add('border-blue-200', 'bg-blue-50/30');
                    description.innerHTML = "<strong>Hoàn thành:</strong> Nguyên tử đã nhận thêm 1e. Lớp ngoài cùng hiện có <strong>8 electron</strong> bền vững giống cấu hình khí hiếm Argon.";
                }
            });
        }

        function resetSimulation() {
            cancelAnimationFrame(animationFrame);
            isIon = false;
            btnAnimate.disabled = false;
            btnAnimate.classList.remove('opacity-40', 'cursor-not-allowed');
            
            // Reset hình ảnh
            gsap.set(".ion-bracket, #charge-sign, #incoming-electron", { opacity: 0 });
            labelName.innerHTML = "Cl";
            labelName.classList.remove('text-blue-600');
            
            outerCountLabel.innerText = "7";
            outerCountLabel.className = "counter-badge bg-slate-100 text-slate-800 px-3 py-1 rounded-full font-bold text-lg border border-slate-200";
            
            statusCard.classList.remove('border-blue-200', 'bg-blue-50/30');
            description.innerHTML = "Nguyên tử Chlorine có 7 electron ở lớp ngoài cùng, còn thiếu 1 electron để đạt trạng thái bền vững (quy tắc bát tử).";

            createElectrons();
            animateLoop();
        }

        btnAnimate.addEventListener('click', startInteraction);
        btnReset.addEventListener('click', resetSimulation);

        window.onload = () => {
            createElectrons();
            animateLoop();
        };
    </script>
</body>
</html>